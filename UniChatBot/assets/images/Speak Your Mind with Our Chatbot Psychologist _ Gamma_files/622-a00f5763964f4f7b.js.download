"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[622],{15850:function(t,e,r){r.d(e,{j:function(){return f}});var n=r(12741),o=r(96412),c=r(13089),u=r(95235);function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach(function(e){(0,u.Z)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var s={model:"gpt-3.5-turbo",provider:r(28811).nyn.Azure},f=function(){function t(e){var r=e.params;(0,o.Z)(this,t),(0,u.Z)(this,"params",void 0),this.params=i(i({},s),r)}return(0,c.Z)(t,[{key:"prepare",value:function(t){var e=t.variables,r=t.history,o=void 0===r?[]:r,c=t.params,u=this.getSystemChatMessage(e),a=this.getUserChatMessage(e);return{messages:[u].concat((0,n.Z)(o),[a]),params:i(i({},this.params),c)}}}]),t}()},38806:function(t,e,r){r.d(e,{T1:function(){return p},VG:function(){return h},Vh:function(){return m},rm:function(){return v}});var n=r(13089),o=r(96412),c=r(41701),u=r(90129),a=r(29017),i=r(48200),s=r(3907),f=r(95235);function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=(0,i.Z)(t);if(e){var o=(0,i.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.Z)(this,r)}}var p=function(t){(0,u.Z)(r,t);var e=l(r);function r(t,n){var u;return(0,o.Z)(this,r),u=e.call(this,t),(0,f.Z)((0,c.Z)(u),"name","StreamError"),(0,f.Z)((0,c.Z)(u),"code","stream_error"),n&&(u.code=n),u}return(0,n.Z)(r)}((0,s.Z)(Error)),v=function(t){(0,u.Z)(r,t);var e=l(r);function r(t){var n;return(0,o.Z)(this,r),n=e.call(this,t),(0,f.Z)((0,c.Z)(n),"name","StreamTimeoutError"),(0,f.Z)((0,c.Z)(n),"code","timeout"),n}return(0,n.Z)(r)}(p),h=function(t){(0,u.Z)(r,t);var e=l(r);function r(t){var n;return(0,o.Z)(this,r),n=e.call(this,t),(0,f.Z)((0,c.Z)(n),"name","StreamOnOpenError"),(0,f.Z)((0,c.Z)(n),"code","on_open"),n}return(0,n.Z)(r)}(p),m=function(t){(0,u.Z)(r,t);var e=l(r);function r(t){var n;return(0,o.Z)(this,r),n=e.call(this,t),(0,f.Z)((0,c.Z)(n),"name","StreamUnexpectedCloseError"),(0,f.Z)((0,c.Z)(n),"code","unexpected_close"),n}return(0,n.Z)(r)}(p)},57060:function(t,e,r){r.d(e,{M:function(){return g}});var n=r(95235),o=r(2784),c=r(46069),u=r(47403),a=r(64805),i=r(20406),s=r(96412),f=r(13089),l=r(41701),p=r(90129),v=r(29017),h=r(48200),m=r(28526),d=r.n(m),b=function(t){(0,p.Z)(o,t);var e,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,r=(0,h.Z)(o);if(e){var n=(0,h.Z)(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return(0,v.Z)(this,t)});function o(t){var e,c;return(0,s.Z)(this,o),e=r.call(this,{start:function(){var e;null===(e=t.onStart)||void 0===e||e.call(t)},transform:(c=(0,i.Z)(d().mark(function r(n,o){var c,u,a;return d().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:"content"===n.event&&(e.content+=n.data,null===(c=t.onContent)||void 0===c||c.call(t,e.content)),"done"===n.event&&(null===(u=t.onComplete)||void 0===u||u.call(t,e.content)),"cancel"===n.event&&(null===(a=t.onCancel)||void 0===a||a.call(t)),o.enqueue(n);case 4:case"end":return r.stop()}},r)})),function(t,e){return c.apply(this,arguments)}),flush:function(){var e;null===(e=t.onFlush)||void 0===e||e.call(t)}}),(0,n.Z)((0,l.Z)(e),"content",""),e}return(0,f.Z)(o,[{key:"getContent",value:function(){return this.content}}]),o}(r(95993).GJ);function O(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function y(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?O(Object(r),!0).forEach(function(e){(0,n.Z)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var g=function(t,e){return{generate:(0,o.useCallback)(function(r){var n=r.variables,o=r.interactionId,i=r.params,s=r.workspaceId;o=o||(0,a.nZ)();var f=t.prepare({variables:n,params:i,interactionId:o}),l=(0,c.z4)(y(y({},f),{},{workspaceId:s,interactionId:o}),{timeout:e.timeout}),p=l.cancel,v=l.stream,h=new b(e),m=v.pipeThrough(h);return{cancel:p,promise:new Promise(function(t,r){(0,u.GO)(m,{onError:function(t){var n;null===(n=e.onError)||void 0===n||n.call(e,t),r(t)},onDone:function(){t(h.getContent())}})})}},[e,t])}}},46069:function(t,e,r){r.d(e,{z4:function(){return E},pM:function(){return w}});var n=r(20406),o=r(95235),c=r(82269),u=r(13089),a=r(96412),i=r(90129),s=r(29017),f=r(48200),l=r(3907),p=r(28526),v=r.n(p),h=r(94889),m=r(95993),d=r(88914),b=r(38806),O=function(t){(0,i.Z)(o,t);var e,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,r=(0,f.Z)(o);if(e){var n=(0,f.Z)(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return(0,s.Z)(this,t)});function o(){var t;return(0,a.Z)(this,o),r.call(this,{transform:(t=(0,n.Z)(v().mark(function t(e,r){return v().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("error"!==e.event){t.next=3;break}return r.error(new b.T1("StreamError message received: ".concat(JSON.stringify(e)),e.data)),t.abrupt("return");case 3:if("cancel"!==e.event){t.next=6;break}return r.enqueue(e),t.abrupt("return");case 6:if("done"!==e.event){t.next=9;break}return r.enqueue(e),t.abrupt("return");case 9:if("content"!==e.event){t.next=12;break}return r.enqueue(e),t.abrupt("return");case 12:case"end":return t.stop()}},t)})),function(e,r){return t.apply(this,arguments)})})}return(0,u.Z)(o)}(m.GJ),y=["streamId","lastEventId","interactionId"],g=["headers"];function A(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function Z(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?A(Object(r),!0).forEach(function(e){(0,o.Z)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var S=function(t){(0,i.Z)(n,t);var e,r=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,r=(0,f.Z)(n);if(e){var o=(0,f.Z)(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return(0,s.Z)(this,t)});function n(t){var e;return(0,a.Z)(this,n),(e=r.call(this)).timeout=t,e}return(0,u.Z)(n)}((0,l.Z)(Error)),E=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=d.v.API_HOST+"/ai/chatCompletion",n={"Content-Type":"application/json"};return e.streamId&&(n["gamma-chat-completion-stream-id"]=e.streamId),_(r,{method:"POST",headers:n,body:JSON.stringify(t)},e)},w=function(t){var e=t.streamId,r=t.lastEventId,n=t.interactionId,o=(0,c.Z)(t,y),u=new URL(d.v.API_HOST+"/ai/resumeChatCompletion");return u.searchParams.set("interactionId",n),_(u.toString(),{method:"GET",headers:{"gamma-chat-completion-stream-id":e,"last-event-id":r}},Z({streamResumingEnabled:!0},o))},_=function(t,e,r){var o,u=r.retries||0,a=r.backoff||1e3,i=r.timeout||null,s=null!==(o=r.streamResumingEnabled)&&void 0!==o&&o,f=0,l=new AbortController,p=!1,d=!1,y=!1,A=null,E=!1,w=function(){return a*Math.pow(2,Math.max(f-1,0))},_={};return s&&(_["gamma-stream-resuming-enabled"]="true"),{stream:new m.Pz({start:function(r){return(0,n.Z)(v().mark(function o(){var a,m;return v().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:null!=i&&(A=setTimeout(function(){E=!0,l.abort(),r.error(new b.rm("Stream timed out after ".concat(i,"ms")))},i)),a=e.headers,m=(0,c.Z)(e,g),(0,h.L)(t,Z(Z({openWhenHidden:!0,credentials:"include"},m),{},{headers:Z(Z({},a),_),signal:l.signal,onopen:function(){var t=(0,n.Z)(v().mark(function t(e){return v().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.ok&&e.headers.get("content-type")===h.a)){t.next=4;break}return t.abrupt("return");case 4:if(!(e.status>=400&&e.status<500&&429!==e.status)){t.next=9;break}l.abort(),r.error(new b.VG("Unable to complete request")),t.next=15;break;case 9:if(!(f++<u&&!p)){t.next=13;break}throw new S(w());case 13:l.abort(),r.error(new b.VG("Unable to complete request"));case 15:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),onmessage:function(t){if(y){d||(d=!0,console.log("[AIStream] enqueue cancel event",Z(Z({},t),{},{event:"cancel",data:""})),r.enqueue(Z(Z({},t),{},{event:"cancel",data:""})),r.close(),l.abort());return}E||(r.enqueue(t),p=!0)},onclose:function(){A&&(clearTimeout(A),A=null),r.close()},onerror:function(t){if(t instanceof S){if(y)throw console.error("Stream cancelled - not retrying"),Error("Stream cancelled");return t.timeout}if(t instanceof Error){if(console.error("Uncaught stream error",t),!s)throw t;if(f++<u)return w();throw t}if(p){var e="Stream closed unexpectedly";throw console.error("Uncaught stream error",e),new b.Vh(e)}}})).catch(function(t){A&&(clearTimeout(A),A=null),y||r.error(t)});case 3:case"end":return o.stop()}},o)}))()}}).pipeThrough(new O),cancel:function(){y||(y=!0)}}}},47403:function(t,e,r){r.d(e,{GO:function(){return i},fZ:function(){return f},uS:function(){return s}});var n=r(20406),o=r(28526),c=r.n(o),u=r(37164),a=r(38806),i=function(t,e){var r,o=t.getReader(),u=(r=(0,n.Z)(c().mark(function t(){var r,n,a,i,s,f;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o.read();case 3:if(n=(r=t.sent).done,a=r.value,n){t.next=12;break}return null===(i=e.onMessage)||void 0===i||i.call(e,a),u(),t.abrupt("return");case 12:null===(s=e.onDone)||void 0===s||s.call(e);case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),null===(f=e.onError)||void 0===f||f.call(e,t.t0 instanceof Error?t.t0:Error(t.t0));case 18:case"end":return t.stop()}},t,null,[[0,15]])})),function(){return r.apply(this,arguments)});u()},s=function(t){return t instanceof a.T1?{errorCode:t.code,errorMessage:t.message}:t instanceof Error?{errorMessage:t.message}:{errorMessage:t}},f=(0,u.kP)("0123456789abcdefghijklmnopqrstuvwxyz",16)},64805:function(t,e,r){r.d(e,{Io:function(){return g},Lt:function(){return y},Wf:function(){return d},XH:function(){return O},fM:function(){return b},gb:function(){return f},hq:function(){return s},mV:function(){return l},nZ:function(){return A},o:function(){return v},pQ:function(){return m},qZ:function(){return p},vL:function(){return h}});var n=r(95235),o=r(37164),c=r(88914),u=r(36188);function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach(function(e){(0,n.Z)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var s=function(t){u.co.track(u.AA.AI_REQUEST_SENT,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},f=function(t){u.co.track(u.AA.AI_REQUEST_COMPLETE,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},l=function(t){u.co.track(u.AA.AI_REQUEST_ABORT,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},p=function(t){u.co.track(u.AA.AI_REQUEST_STREAM_START,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},v=function(t){u.co.track(u.AA.AI_REQUEST_RESPONSE,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},h=function(t){u.co.track(u.AA.AI_SUGGESTION_APPLY,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},m=function(t){u.co.track(u.AA.AI_REQUEST_ERROR,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},d=function(t){u.co.track(u.AA.AI_REQUEST_RETRY,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},b=function(t){u.co.track(u.AA.AI_DOC_RATED,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},O=function(t){u.co.track(u.AA.AI_DOC_FEEDBACK_SUBMITTED,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},y=function(t){u.co.track(u.AA.AI_IMAGE_FEEDBACK_SUBMITTED,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},g=function(t){u.co.track(u.AA.AI_IMAGE_RATED,i(i({},t),{},{gitSHA:c.v.GIT_SHA}))},A=function(){return(0,o.x0)()}}}]);
//# sourceMappingURL=622-a00f5763964f4f7b.js.map